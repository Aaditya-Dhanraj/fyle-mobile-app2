<ion-header>
  <ion-toolbar class="notifications--toolbar">
    <ion-buttons mode="md" slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title mode="md">Notifications</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="notifications--container">
    
    <div class="notifications--notif-setting-header">
      Set notifications you want to receive
    </div>

    <form [formGroup]="notificationForm">
      <ng-container *ngIf="isDelegateePresent$|async">
        <h2>Delegatee Notification</h2>
        <mat-form-field class="notifications--form-fields">
          <mat-select formControlName="notifyOption">
            <mat-option *ngFor="let option of delegationOptions" [value]="option">
              {{option}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </ng-container>

      <div>
        <div *ngIf="notificationEvents$|async  as notificationEvents">
          <div *ngFor="let feature of notificationEvents['features']|keyvalue; index as i;first as $first;">
            <ion-grid fixed>
              <ion-row>
                <ion-col size="7">
                  <div class="feature-name">
                    <h4 class="item-col feature-name">
                      <strong>{{ feature.value.textLabel }}</strong>
                    </h4>
                  </div>
                </ion-col>
                <ion-col size="5" class="notifications--select-box">
                  <div *ngIf="$first && (orgUserSettings$|async)?.notification_settings?.push.enabled" class="toggle-select-all feature-toggle">
                    <mat-checkbox class="notifications--checkbox-square-header" [checked]="isAllSelected.pushEvents" (change)="toggleAllSelected('push')" color="primary"></mat-checkbox>
                    <mat-icon svgIcon="fy-iphone" class="notifications--type-icon"></mat-icon>
                  </div>
                  <div *ngIf="$first" class="toggle-select-all feature-toggle">
                    <mat-checkbox *ngIf="$first" class="notifications--checkbox-square-header" color="primary" [checked]="isAllSelected.emailEvents" (change)="toggleAllSelected('email')"></mat-checkbox>
                    <mat-icon svgIcon="fy-email" class="notifications--type-icon"></mat-icon>
                  </div>
                </ion-col>
              </ion-row>
            </ion-grid>

            <div class="features-list-row" *ngFor="let event of notifEvents; index as i;let odd=odd;">
              <div class="feature-name" *ngIf="event.feature === feature.key">
                <ion-grid [ngClass]="{'notifications--odd': odd}">
                  <ion-row>
                    <ion-col size="7">
                      <p class="m-0">{{ event.textLabel }}</p>
                    </ion-col>
                    <ion-col size="5" class="notifications--select-box">
                      <div formArrayName="pushEvents">
                        <mat-checkbox *ngIf="(orgUserSettings$|async).notification_settings?.push.enabled" color="primary" class="notifications--checkbox-square" formControlName="{{i}}"></mat-checkbox>
                      </div>
                      <div formArrayName="emailEvents">
                        <mat-checkbox class="notifications--checkbox-square" formControlName="{{i}}" color="primary"></mat-checkbox>
                      </div>
                    </ion-col>
                  </ion-row>
                </ion-grid>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
    <div>
      <div class="notifications--action-button" (click)="saveNotificationSettings()">save</div>
    </div>
  </div>
</ion-content>
