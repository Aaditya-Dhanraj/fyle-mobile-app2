<ion-header class="ion-no-border">
  <div class="my-create-report--header">
    <ion-toolbar class="ion-no-border my-create-report--header-toolbar">
      <ion-buttons mode="md" slot="start">
        <ion-button class="my-create-report--header-closebutton" (click)="cancel()">
          <mat-icon svgIcon="fy-close" class="fy-icon-close"></mat-icon>
        </ion-button>
      </ion-buttons>
      <div class="my-create-report--title-container text-center">
        <div class="my-create-report--title">Create New Report</div>
        <div class="my-create-report--sub-title">
          {{ selectedElements?.length }} {{ selectedElements?.length > 1 ? 'Expenses' : 'Expense' }} -
          {{ homeCurrencySymbol }} {{ selectedTotalAmount || 0 | humanizeCurrency: homeCurrency:2:true }}
        </div>
      </div>
    </ion-toolbar>
  </div>
</ion-header>

<ion-content>
  <div class="my-create-report--container">
    <div class="my-create-report--report-card">
      <div class="my-create-report--report-title">Report Name</div>
      <span class="my-create-report--mandatory"> * </span>
      <input
        class="my-create-report--report-name"
        name="reportName"
        type="text"
        placeholder="Enter Report Title"
        [(ngModel)]="reportTitle"
        required
        #reportTitleInput="ngModel"
      />
    </div>
    <div class="my-create-report--error-message" *ngIf="showReportNameError">Please enter report name.</div>

    <div
      class="my-create-report--report-card"
      *ngIf="canAssociateTripRequests && (tripRequests && tripRequests.length > 0)"
    >
      <span>Select a trip to associate with report:</span>
      <div class="my-create-report--select-trip">
        <app-fy-select
          [label]="'Trip'"
          [options]="tripRequests"
          [(ngModel)]="selectedTripRequest"
          [selectModalHeader]="'Select a Trip Request'"
          [cacheName]="'recentTripRequestsList'"
        >
        </app-fy-select>
      </div>
    </div>

    <div *ngIf="readyToReportEtxns?.length === 0" class="my-create-report--zero-state">
      <img
        alt="Create First Expenses"
        class="my-create-report--zero-state-img"
        src="../../../assets/images/zero-states/expenses.svg"
      />
      <p class="my-create-report--zero-state-header">
        <a href [routerLink]="['/','enterprise','add_edit_expense']">Create expense</a> to start adding them to reports
      </p>
    </div>

    <div class="my-create-report--report-card" *ngIf="!isTripRequestsEnabled && readyToReportEtxns?.length > 0">
      <p class="my-create-report--report-title">Trip Request ID</p>
      <input
        class="my-create-report--text-trip"
        type="text"
        placeholder="Enter Trip Request ID"
        [(ngModel)]="tripRequestId"
      />
    </div>

    <div class="my-create-report--heading">EXPENSES</div>
    <div class="my-create-report--select-all-checkbox">
      <mat-checkbox class="custom-mat-checkbox create-new-report--checkbox" 
      [(ngModel)]="isSelectedAll"
      (ngModelChange)="toggleSelectAll($event)">
      Select all</mat-checkbox>
    </div>

    <div *ngIf="readyToReportEtxns">
      <div *ngFor="let etxn of readyToReportEtxns as list; let i = index">
        <app-expense-card
          [expense]="etxn"
          [previousExpenseTxnDate]="readyToReportEtxns[i - 1]?.tx_txn_dt"
          [previousExpenseCreatedAt]="readyToReportEtxns[i - 1]?.tx_created_at"
          [isSelectionModeEnabled]="true"
          [selectedElements]="selectedElements"
          (cardClickedForSelection)="selectExpense($event)"
        >
        </app-expense-card>
      </div>
    </div>

    <!-- <div class="my-create-report--add-more-container" (click)="closeEvent()">
      <mat-icon class="my-create-report--add-more-icon" svgIcon="plus"></mat-icon>
      <div class="my-create-report--add-more-text">Add More Expenses</div>
    </div> -->
  </div>
</ion-content>

<ion-footer>
  <ion-toolbar mode="md">
    <div class="my-create-report--footer">
      <ion-grid>
        <ion-row>
          <ion-col size="8">
            <div>
              <span class="my-create-report--footer-currency">{{homeCurrency$|async}}</span>
              <span class="my-create-report--footer-amount"> {{selectedTotalAmount | number: '1.2-2'}} </span>
            </div>
            <div class="my-create-report--footer-summary">{{selectedTotalTxns}} expenses selected</div>
          </ion-col>

          <ion-col size="4">
            <div
              *ngIf="readyToReportEtxns && readyToReportEtxns?.length > 0"
              class="my-create-report--secondary-action"
            >
              <span *ngIf="readyToReportEtxns.length === selectedTotalTxns" (click)="toggleSelectAll(false)"
                >Unselect All</span
              >
              <span *ngIf="readyToReportEtxns.length !== selectedTotalTxns" (click)="toggleSelectAll(true)"
                >Select All</span
              >
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
      <ion-buttons>
        <ion-button
          class="my-create-report--primary-cta"
          fill="outline"
          color="fyle-primary"
          (click)="showReportSummaryPopover('draft')"
          appFormButtonValidation
          [loading]="saveDraftReportLoading"
          [loadingText]="'SAVING'"
          [disabled]="saveDraftReportLoading  || saveReportLoading"
        >
          SAVE DRAFT
        </ion-button>
        <ion-button
          class="my-create-report--primary-cta"
          fill="solid"
          color="fyle-primary"
          (click)="showReportSummaryPopover('submit')"
          appFormButtonValidation
          [loading]="saveReportLoading"
          [loadingText]="'SAVING'"
          [disabled]="saveDraftReportLoading  || saveReportLoading || this.selectedTotalTxns === 0"
        >
          SUBMIT REPORT
        </ion-button>
      </ion-buttons>
    </div>
  </ion-toolbar>
</ion-footer>
