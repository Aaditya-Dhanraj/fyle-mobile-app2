<ion-header>
  <ion-toolbar class="view-advances--toolbar">
    <ion-buttons mode="md" slot="start">
      <button mat-icon-button [routerLink]="['/','enterprise','team_advance']">
        <mat-icon>
          keyboard_backspace
        </mat-icon>
      </button>
    </ion-buttons>
    <ion-title mode="md">
      View Advance
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div *ngIf="advanceRequest$|async as advanceRequest">
    <div class="view-advances--attachment-currency-container">
      <p class="view-advances--content-header">
        Advance Request
      </p>
      <!-- <div class="view-advances--attachment-card text-center" *ngIf="attachedFiles$|async as attachedFiles">
        <div class="view-advances--no-attachment" *ngIf="attachedFiles.length === 0">
          <p class="view-advances--add-receipt-text">No Receipts</p>
        </div>
        <div class="view-advances--attachments" *ngIf="attachedFiles.length > 0">
          <div class="view-advances--receipt-thumbnails" *ngIf="attachedFiles[0].file_type === 'image'" [ngStyle]="{'background-image': 'url(' + attachedFiles[0].file_download_url + ')'}"></div>
          <div class="view-advances--pdf-thumbnails"  *ngIf="attachedFiles[0].file_type === 'pdf'">
            <img src="assets/images/fy-pdf.svg" alt="">
          </div>
          <div *ngIf="attachedFiles.length > 1" class="view-advances--receipt-count">
            <span class="view-advances--additional-icon">
              <ion-icon name="add-outline"></ion-icon>
            </span>
            <span class="view-advances--count">{{attachedFiles.length-1}}</span>
          </div>
        </div>
      </div> -->
      <!-- <div class="view-advances--currency-card">
        <div class="view-advances--currency">
          {{advanceRequest.areq_currency}}
        </div>
        <div class="view-advances--amount">
            {{advanceRequest.areq_amount}}
        </div>
      </div> -->

    </div>

    <div class="view-advances--card">
      <div class="view-advances--element">
        <div class="view-advances--element-label">
          Created On
        </div>
        <div class="view-advances--element-value">
          {{advanceRequest.areq_created_at | date: 'dd, MMM yyyy'}}
        </div>
      </div>

      <div class="view-advances--element">
        <div class="view-advances--element-label">
          State
        </div>
        <div class="view-advances--element-value">
          {{advanceRequest.areq_state}}
        </div>
      </div>

      <div class="view-advances--element">
        <div class="view-advances--element-label">
          Amount
        </div>
        <div class="view-advances--element-value">
          {{advanceRequest.areq_amount | currency: advanceRequest.areq_currency :true}}
        </div>
      </div>

      <div class="view-advances--element">
        <div class="view-advances--element-label">
          Employee
        </div>
        <div class="view-advances--element-value">
          {{advanceRequest.us_full_name}}
        </div>
      </div>

      <div class="view-advances--element">
        <div class="view-advances--element-label">
          Purpose
        </div>
        <div class="view-advances--element-value">
          {{advanceRequest.areq_purpose}}
        </div>
      </div>

      <div class="view-advances--element">
        <div class="view-advances--element-label">
          Description
        </div>
        <div class="view-advances--element-value">
          {{advanceRequest.areq_notes}}
        </div>
      </div>

      <div *ngIf="advanceRequest.project_name" class="view-advances--element">
        <div class="view-advances--element-label">
          Project
        </div>
        <div class="view-advances--element-value">
          {{advanceRequest.project_name}}
        </div>
      </div>

      <div class="view-advances--element" >
        <div class="view-advances--element-label">
          Approvers
        </div>
        <div class="view-advances--element-value">
          <div *ngFor="let activeApproval of activeApprovals$ | async as list">
            <span>{{activeApproval.approver_name}}</span>
            <p>({{activeApproval.state | advanceState}})</p>
          </div>
        </div>
      </div>

      <!-- Custom Fields block -->
      <div *ngIf="(advanceRequestCustomFields$|async)?.length > 0">
        <div class="view-advances--element" *ngFor="let advanceRequestCustomField of advanceRequestCustomFields$ | async; index as i">
          <div class="view-advances--element-label">
            {{advanceRequestCustomField.name}}
          </div>
          <div class="view-advances--element-value">
            <span *ngIf="advanceRequestCustomField.type === 'DATE'">{{advanceRequestCustomField.value | date: 'dd, MMM yyyy'}}</span>
            <span *ngIf="advanceRequestCustomField.type === 'BOOLEAN'">{{advanceRequestCustomField.value ? 'Yes' : 'No'}}</span>
            <span *ngIf="advanceRequestCustomField.type !== 'BOOLEAN' && advanceRequestCustomField.type !== 'DATE'">{{advanceRequestCustomField.value}}</span>
          </div>
        </div>
      </div>
    
    </div>

    <div class="view-advances--card" *ngIf="(actions$|async)?.can_edit">
      <div class="view-advances--common-action-block" (click)=edit()> 
        <mat-icon>edit</mat-icon>
        <p>Edit Advance</p>
      </div>
    </div>

    <!-- TODO: make a proper method call -->
    <div class="view-advances--card" *ngIf="(actions$|async)?.can_edit">
      <div class="view-advances--common-action-block" (click)=edit()> 
        <mat-icon>add_circle</mat-icon>
        <p>Add Approvers</p>
      </div>
    </div>

      <!-- Todo: comment copmponnet -->
      <div class="view-advances--card">
      <div class="view-advances--common-action-block">
        <mat-icon>chat</mat-icon>
        <p>Comment (0)</p>
      </div>
    </div>

  </div>

</ion-content>

<ion-footer *ngIf="(actions$|async)?.can_pull_back">
  <ion-toolbar>
    <ion-button class="view-advances--primary-cta flat-button" fill="solid" color="fyle-primary" expand="block" (click)="pullBack()">
      Pull Back
    </ion-button>
  </ion-toolbar>
</ion-footer>
