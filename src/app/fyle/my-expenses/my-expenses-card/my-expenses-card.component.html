<div>
  <div class="my-expenses-card--date" *ngIf="showDt">
    <div *ngIf="expense.tx_txn_dt">
      {{expense.tx_txn_dt | date: 'EEEE'}}
    </div>
    <div *ngIf="expense.tx_txn_dt">
      {{expense.tx_txn_dt | date: 'dd MMMM yyyy'}}
    </div>
    <div *ngIf="!expense.tx_txn_dt">
      {{expense.tx_created_at | date: 'EEEE'}}
    </div>
    <div *ngIf="!expense.tx_txn_dt">
      {{expense.tx_created_at | date: 'dd MMMM yyyy'}}
    </div>
  </div>
  <div class="my-expenses-card">
    <div class="my-expenses-card--decorator" *ngIf="expense.tx_state === 'DRAFT'">
      Draft
    </div>
    <div class="my-expenses-card--decorator" *ngIf="expense.tx_user_review_needed && !isDraft">
      Needs Review
    </div>
    <div class="my-expenses-card--decorator my-expenses-card--decorator__policy-violation"
      *ngIf="expense.tx_id && isPolicyViolated && !isCriticalPolicyViolated">
      Policy Violation
    </div>
    <div class="my-expenses-card--decorator" *ngIf="expense.tx_id && isCriticalPolicyViolated">
      Critical Policy Violation
    </div>

    <div matRipple class="my-expenses-card--body my-expenses-card--body__closed" *ngIf="!actionOpened && !isSelectMode"
      (click)="onGoToTransaction()">
      <div class="my-expenses-card--body-internal">
        <div class="my-expenses-card--icon">
          <mat-icon>
            fastfood
          </mat-icon>
        </div>
        <div class="my-expenses-card--details">
          <div class="my-expenses-card--amount-details">
            <div class="my-expenses-card--currency">
              {{expense.tx_currency || expense?.tx_extracted_data?.currency}}
            </div>
            <div class="my-expenses-card--amount">
              <div *ngIf="amountIsNumber || extractedAmountIsNumber">
                {{(expense.tx_amount || expense?.tx_extracted_data?.amount) | number:'1.2'}}
              </div>
              <div *ngIf="!amountIsNumber && !extractedAmountIsNumber">
                --
              </div>
              <div *ngIf="!expense.tx_amount && expense?.tx_extracted_data?.amount">
                <!-- <i class="icon ion-flash icon-flash" (click)="onToggleFlashMode()"></i> -->
                <mat-icon>
                  flash
                </mat-icon>
              </div>
              <div class="my-expenses-card--conversion" *ngIf="expense.tx_orig_currency && expense.tx_orig_amount">
                <!-- ({{ expense.tx_orig_amount | isoCurrency:expense.tx_orig_currency:2 }} at -->
                <!-- {{ (expense.tx_amount / expense.tx_orig_amount) | isoCurrency:expense.tx_currency:2 }})</div> -->
                ({{ expense.tx_orig_amount }} at {{ (expense.tx_amount / expense.tx_orig_amount) | number: '1.2'}})
              </div>
            </div>
          </div>
          <div class="my-expenses-card--vendor">
            {{vendorDetails}}
          </div>
          <div class="my-expenses-card--category">
            {{expense.tx_org_category === 'Unspecified' && expense?.tx_extracted_data?.category ? expense?.tx_extracted_data?.category : expense.tx_org_category}}
          </div>
        </div>
      </div>

      <div (click)="actionOpened = true">
        <mat-icon>
          more_horiz
        </mat-icon>
        <!-- <ion-spinner icon="spiral" *ngIf="vm.isDataExtractionInProgress(expense.tx_id)">
        </ion-spinner> -->
      </div>
    </div>

    <div class="my-expenses-card-menu" *ngIf="actionOpened">
      <div class="my-expenses-card-menu--close">
        <div matRipple (click)="actionOpened = false" class="my-expenses-card-menu--cancel">
          <mat-icon>
            close
          </mat-icon>
        </div>
      </div>

      <div class="my-expenses-card-menu--buttons">
        <div matRipple class="my-expenses-card-menu--action my-expenses-card-menu--action__comments"
          (click)="onAddTransactionToReport()"
          [ngClass]="{'my-expenses-card-menu--action__disabled': (isDraft || isCriticalPolicyViolated)}">
          <span *ngIf="addToReportPossible$|async">Add to Report</span>
          <span *ngIf="!(addToReportPossible$|async)">Add to New Report</span>
        </div>
        <div matRipple class="my-expenses-card-menu--action my-expenses-card-menu--action__delete"
          [class]="{'my-expenses-card-menu--action__disabled': !expense.tx_user_can_delete}"
          (click)="onDeleteTransaction()">
          <span>Delete</span>
        </div>
      </div>
    </div>

    <div class="my-expenses-card--body my-expenses-card--body__selection" *ngIf="isSelectMode">
      <ion-checkbox mode="md" ng-model="expense.selected" (click)="onSelectTransaction()"
        [disabled]="disabledSelection">
        <!-- [disabled]="(expense.isDraft && activeTab === 'all') || expense.isCriticalPolicyViolated"> -->
      </ion-checkbox>
      <div>
        <div>
          <div>
            {{expense.tx_currency}}
          </div>
          <div>
            <div *ngIf="amountIsNumber">
              {{expense.tx_amount}}
            </div>
            <div *ngIf="!amountIsNumber">
              --
            </div>
          </div>
        </div>
        <div>
          {{vendorDetails}}
        </div>
        <div>
          {{expense.tx_org_category}}
        </div>
      </div>
    </div>
  </div>
</div>